５．北陸トンネルね！いっちょらい！ ～Exception テスト～
=====

[↑目次](../README.md "目次")

[← ４．敦賀駅 ～とらいあんぎゅれーしょん？？～](doc/04.md "４．敦賀駅 ～とらいあんぎゅれーしょん？？～")

空ならPopできない
-----

空のスタックに対して`Pop`メソッドを読んだときに、`InvalidOperationException`が発生することを確認するテストを追加します。

```csharp
[Fact]
public void 空ならPopできない()
{
    Assert.Throws<InvalidOperationException>(() =>
    {
        stack.Pop();
    });
}
```

xUnit\.netでは、特定の例外を期待するテストは、`Assert.Throws`メソッドを使います。この時、期待する例外の型を型引数に、例外が発生する処理をラムダ式で指定します。

`Pop`メソッドがないので、これまでと同様に生成します。

```csharp
public void Pop()
{
    throw new NotImplementedException();
}
```

そしてテストを実行して赤になることを確認します。

![例外を期待するテストが赤](images/05-01.png)

テスト結果を見ると、発生した例外の期待した型と実際の型が異なっていることが分かります。

それでは、テストを通すために`Pop`メソッドで`throw`している例外の型を、期待している`InvalidOperationException`に変更しましょう。

```csharp
public void Pop()
{
    throw new InvalidOperationException();
}
```

テストを実行して緑になること確認します。

![例外を期待するテストが緑](images/05-02.png)


一度PushしたらPopできる
-----

今度はPushしたあとにPopできるように変更します。元文書のようにドライバーを変更して、次のテストメソッドを追加します。

```csharp
[Fact]
public void 一度PushしたらPopできる()
{
    stack.Push(1);
    stack.Pop();
    //Assert.Equal(0, stack.Size);  おそらく間違いなので削除
}
```

このテストの目的には`Size`プロパティは関係ないので、元文書の`size`メソッドに対する検証行は削除します。

それでは、テストが赤になることを確認しましょう。

![Popできるテストが赤](images/05-03.png)

そして、テストが通るように`Pop`メソッドを変更します。

```csharp
public void Pop()
{
    if (IsEmpty) throw new InvalidOperationException();
}
```

C#では、基本的に`if`文の`{`、`}`は省略しませんが、今回のように`throw`したり`return`する場合は、特例として「１行で書くこと」を条件に、省略してしまうこともよくあります。

テストを実行して緑になることを確認しておきましょう。

