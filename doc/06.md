６．トンネルを抜けると、そこは？！ ～TDD ラストスパート～
=====

[↑目次](../README.md "目次")

[← ５．北陸トンネルね！いっちょらい！ ～Exception テスト～](05.md "５．北陸トンネルね！いっちょらい！ ～Exception テスト～")

PushしてPopしたら空になる
-----

Popしたら一番上の要素を取り除くことを確認するため、テストコードを追加します。元文書では`testPushAndPop`メソッドでやっていますが、本文書では対応するテストメソッド名を変更して、`Size`を確認するようにしてみましょう。

```csharp
[Fact]
// public void 一度PushしたらPopできる()    メソッド名を変更
public void PushしてPopしたら空になる()
{
    stack.Push(1);
    stack.Pop();
    Assert.Equal(0, stack.Size);    // 前の章では削除していたコードを復活
}
```

テストが赤になることを確認しましょう。

![サイズが0になるテストが赤](images/06-01.png)

そして、元文書のように`Pop`メソッドで`size`フィールドをデクリメントするコードを追加し、テストが緑になることを確認します。

```csharp
public void Pop()
{
    AssertNotEmpty();
    size--;             // 追加
}
```

さて、ここまでのコードを見ると、`size`フィールドは`Size`プロパティの「バッキングフィールド」としか使っていないことが分かります。C#のプロパティは、`set`のみ`private`にするようなアクセス制限が可能ですので、そのように変更してしまいましょう。

この操作は、`Size`プロパティの行にカーソルをあて、`Ctrl`+`.`キーでクイック操作を開き、［自動プロパティを使用する］を選択すると、自動で変換してくれます。

![自動プロパティを使用する](images/06-02.png)

変換した後は、すべての個所で`Size`プロパティが使われるように変更されます。

```csharp
public bool IsEmpty => Size == 0;

public int Size { get; private set; }

public void Push(int value)
{
    this.value = value;
    Size++;
}

public void Pop()
{
    AssertNotEmpty();
    Size--;
}
```